<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PRO-STATE — Level 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.png">


<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    background:black;
    font-family:'Press Start 2P', monospace;
    color:white;
    overflow:hidden;
}

/* BACKGROUND VIDEO */
video {
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    min-width:100%;
    min-height:100%;
    opacity:0.25;
    z-index:-1;
}

/* GAME */
.game {
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
}

/* HEALTH BAR */
.health-container {
    width:320px;
    height:20px;
    border:3px solid white;
    margin-bottom:10px;
}
.health-bar {
    height:100%;
    width:100%;
    background:lime;
    transition:width 0.15s;
}

.combo {
    font-size:14px;
    color:cyan;
    margin-bottom:12px;
}

/* LANE */
.note-lane {
    position:relative;
    width:400px;
    height:360px;
    border:3px solid white;
    background:rgba(255,255,255,0.05);
    overflow:hidden;
}

.note-lane::before {
    content:"";
    position:absolute;
    left:100px;
    width:1px;
    height:100%;
    background:rgba(255,255,255,0.2);
    box-shadow:100px 0 rgba(255,255,255,0.2),
               200px 0 rgba(255,255,255,0.2);
}

.hit-line {
    position:absolute;
    bottom:70px;
    width:100%;
    height:4px;
    background:linear-gradient(90deg, cyan, lime, cyan);
    box-shadow:0 0 15px cyan;
}

/* NOTES */
.note {
    position:absolute;
    width:60px;
    top:-80px;
    image-rendering:pixelated;
}

.lane-ArrowLeft  { left:20px; }
.lane-ArrowDown  { left:120px; }
.lane-ArrowUp    { left:220px; }
.lane-ArrowRight { left:320px; }

/* ARROWS */
.arrows {
    display:flex;
    gap:30px;
    margin-top:15px;
}

.arrow {
    width:80px;
    opacity:0.4;
    transition:0.1s;
}

.arrow.active {
    opacity:1;
    transform:scale(1.25);
    filter:drop-shadow(0 0 10px cyan);
}

/* POPUP */
.popup {
    position:absolute;
    font-size:14px;
    animation:float 0.6s forwards;
}

.perfect { color:lime; }
.good { color:yellow; }

@keyframes float {
    from { opacity:1; transform:translateY(0); }
    to { opacity:0; transform:translateY(-30px); }
}
</style>
</head>

<body>

<video src="player.mp4" autoplay loop muted></video>
<audio id="music" src="g1.mp3"></audio>

<div class="game">

    <div class="health-container">
        <div class="health-bar" id="health-bar"></div>
    </div>

    <div class="combo" id="combo">COMBO: 0</div>

    <div class="note-lane">
        <div id="notes"></div>
        <div class="hit-line"></div>
    </div>

    <div class="arrows">
        <img src="images/left.png"  id="ArrowLeft"  class="arrow">
        <img src="images/down.png"  id="ArrowDown"  class="arrow">
        <img src="images/up.png"    id="ArrowUp"    class="arrow">
        <img src="images/right.png" id="ArrowRight" class="arrow">
    </div>

</div>

<script>
/* SETTINGS */
const BPM = 140;                    // faster tempo
const BEAT = 60000 / BPM;           // ms per beat
const FALL = 0.18;                  // arrow fall speed
const HIT_Y = 260;
const PERFECT = 18;
const GOOD = 40;

const KEYS = ["ArrowLeft","ArrowDown","ArrowUp","ArrowRight"];

/* STATE */
let combo = 0;
let notes = [];
let start;
let running = true;

const notesDiv = document.getElementById("notes");
const comboText = document.getElementById("combo");
const music = document.getElementById("music");

let lastTime = null;

/* CHART — full song (~3:19 = 199 sec) random but no same key twice in a row */
function loadChart() {
    const chart = [];
    const songLength = 199000; // 3:19 in ms
    let t = 1500;               // start delay
    let lastKey = null;

    while (t < songLength) {
        let key;
        do {
            key = KEYS[Math.floor(Math.random() * KEYS.length)];
        } while (key === lastKey);
        lastKey = key;

        chart.push({
            key: key,
            time: t,
            y: -80,
            el: null,
            hit: false
        });

        t += BEAT; // next beat
    }

    return chart;
}

/* SPAWN NOTE */
function spawn(n) {
    const el = document.createElement("img");
    el.src = `images/${n.key.replace("Arrow","").toLowerCase()}.png`;
    el.className = `note lane-${n.key}`;
    notesDiv.appendChild(el);
    n.el = el;
}

/* POPUP */
function popup(text, cls) {
    const p = document.createElement("div");
    p.className = `popup ${cls}`;
    p.textContent = text;
    p.style.left = "50%";
    p.style.top = "45%";
    p.style.transform = "translateX(-50%)";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),600);
}

/* GAME LOOP */
function loop(now) {
    if (!running) return;
    if (!lastTime) lastTime = now;
    const delta = now - lastTime;
    lastTime = now;

    const elapsed = now - start;

    notes.forEach(n => {
        if (!n.el && elapsed >= n.time - 1000) spawn(n);

        if (n.el && !n.hit) {
            n.y += FALL * delta;
            n.el.style.top = n.y + "px";
        }
    });

    requestAnimationFrame(loop);
}

/* HIT DETECTION */
function hit(key) {
    if (!running) return;

    const n = notes.find(x =>
        !x.hit &&
        x.key === key &&
        Math.abs(x.y - HIT_Y) < GOOD
    );

    if (!n) return;

    const d = Math.abs(n.y - HIT_Y);
    n.hit = true;
    if(n.el) n.el.remove();

    if (d <= PERFECT) popup("PERFECT","perfect");
    else popup("GOOD","good");

    combo++;
    comboText.textContent = `COMBO: ${combo}`;
}

/* INPUT */
document.addEventListener("keydown", e => {
    if (!KEYS.includes(e.key)) return;
    document.getElementById(e.key).classList.add("active");
    hit(e.key);
});

document.addEventListener("keyup", e => {
    if (KEYS.includes(e.key))
        document.getElementById(e.key).classList.remove("active");
});

/* START GAME */
document.addEventListener("keydown", () => {
    notes = loadChart();
    start = performance.now();
    music.play();
    requestAnimationFrame(loop);
}, { once:true });
</script>


</body>
</html>